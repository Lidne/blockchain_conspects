# Конспект второй лекции

## 1. Основные понятия и работа с Ethereum-сетью
- Смарт-контракты — это программные коды, которые работают на блокчейне Ethereum и автоматически выполняют операции по заданным условиям.
- Работать с ними можно через различные сети, например, тестовую сеть **Гёрли (Goerli)**. Эта сеть актуальна, так как поддерживает последние обновления Ethereum. *(на данный момент эта сеть не работает)*
- Взаимодействие со смарт-контрактами для клиентов происходит через специальные кошельки, например, **MetaMask**. Клиент подтверждает транзакции через всплывающие окна.
- Примеры использования: переводы эфира в контракт, блокировка токенов и другие финансовые операции.

## 2. Транзакции в Ethereum
- Транзакция содержит информацию о вызове функции контракта, адрес, данные и подпись пользователя.
- **MetaMask** помогает создавать и подписывать транзакции, но сам код контрактов не зависит от него. 
- Транзакция проходит несколько этапов: подготовка, отправка в сеть, ожидание подтверждения майнерами, включение в блок и обновление состояния контракта.
- Существует механизм реверта транзакций (откат), если они не проходят проверку (например, недостаточно газа).

## 3. Web3-разработка и Backend
- Web3-разработка требует знаний не только о блокчейнах, но и о классических веб-технологиях (backend). Например, Node.js используется для создания простых интерфейсов взаимодействия с контрактами.
- Веб-интерфейсы могут отображать результаты работы контрактов, такие как балансы, проценты, и другие агрегированные данные.

## 4. Ноды Ethereum
- Ноды Ethereum обрабатывают транзакции и синхронизируются через протоколы, как **P2P**. Каждая нода проверяет транзакции, хранит блоки и выполняет код контрактов.
- **Архивные ноды** содержат полную историю блоков и позволяют запросить состояние на любой момент времени. Хранение полной базы данных требует больших ресурсов.
- Ноды бывают **полные** (full nodes), которые держат актуальное состояние блокчейна, и **легкие** (light nodes), которые используют минимальный объем данных и подписаны на определенные события.

## 5. Принципы работы с данными в смарт-контрактах
- Смарт-контракты имеют **storage** (хранилище данных) и **memory** (оперативную память). Storage используется для хранения постоянных данных, а memory для временных операций.
- Хранилище контрактов организовано в формате **ключ-значение (key-value)**, что обеспечивает детерминированное расположение данных на всех компьютерах сети.
- Код смарт-контракта представляет собой **байт-код**, исполняемый на **виртуальной машине Ethereum (EVM)**.

## 6. Взаимодействие с контрактами
- В Ethereum используется объектно-ориентированный язык программирования **Solidity**.
- Смарт-контракты имеют:
  - Конструкторы для инициализации данных при деплое.
  - Публичные и приватные функции и переменные.
  - Специальные функции для обработки эфира — **payable**.
  - Getter-функции, которые позволяют бесплатно получать данные из блокчейна (например, текущий баланс), и setter-функции для записи данных.

## 7. Безопасность и управление ключами
- Безопасность контрактов и приватных ключей полностью лежит на пользователе. В случае потери ключей восстановить доступ невозможно.
- Для обеспечения безопасности рекомендуется использовать **аппаратные кошельки** (флешки с встроенным ключом), которые защищены от хакеров.
  
## 8. Распределенные базы данных и аналогия с блокчейном
- Блокчейн можно рассматривать как распределенную базу данных с механизмами консенсуса, похожими на мастеровую репликацию в базах данных.
- Концепция блокчейна и алгоритмы консенсуса используют многие принципы, применяемые в высоконагруженных системах баз данных.

## 9. Пример структуры контракта
- **Storage** хранит постоянные данные контракта.
- **Memory** используется для временных вычислений во время исполнения функции.
- Переменные внутри контракта индексируются по ключам и имеют детерминированное расположение в хранилище.
  
## Заключение
Работа со смарт-контрактами Ethereum требует понимания не только блокчейн-архитектуры, но и навыков Web2 разработки. Важно уметь обращаться с распределенными системами, а также обеспечивать высокий уровень безопасности.